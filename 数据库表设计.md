# 数据库表设计（含建表 SQL 与索引示例）

> 说明  
> - 本文件基于《功能原型设计.md》整理，采用 **MySQL 8 / InnoDB / utf8mb4** 作为参考。  
> - 字段类型与默认值可在实际落地时按需要微调（若使用 SQLite，需要适配类型与自增写法）。  
> - 所有 SQL 仅为「建议脚本」，不会直接改动你的数据库，执行前请自行确认。

---

## 一、通用设计约定

- 主键：各表统一使用 `id BIGINT UNSIGNED AUTO_INCREMENT` 作为主键。
- 时间字段：
  - `created_at DATETIME` 创建时间，默认 `CURRENT_TIMESTAMP`
  - `updated_at DATETIME` 更新时间，默认 `CURRENT_TIMESTAMP` 并 `ON UPDATE`
- 如需软删除，可为部分表增加：`is_deleted TINYINT(1) NOT NULL DEFAULT 0`。
- 所有与用户相关的业务表一般包含 `user_id`（所属学生用户）。

---

## 二、账号与认证相关

### 1. 用户表 `users`

**用途**：保存平台用户的基础信息。

**字段建议**
- `id`：主键
- `username`：账号名（可选）
- `phone`：手机号（唯一索引，可为空）
- `email`：邮箱（可选）
- `password_hash`：密码摘要（如 bcrypt）
- `nickname`：昵称
- `avatar_url`：头像地址
- `bio`：简介 / 个性签名
- `status`：账号状态（正常 / 禁用 / 注销）
- `created_at` / `updated_at`

**示例建表 SQL（MySQL）**
```sql
CREATE TABLE `users` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(64) DEFAULT NULL,
  `phone` VARCHAR(20) DEFAULT NULL,
  `email` VARCHAR(128) DEFAULT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `nickname` VARCHAR(64) NOT NULL,
  `avatar_url` VARCHAR(255) DEFAULT NULL,
  `bio` VARCHAR(255) DEFAULT NULL,
  `status` TINYINT NOT NULL DEFAULT 1 COMMENT '1=正常,0=禁用,2=注销',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_users_phone` (`phone`),
  UNIQUE KEY `uk_users_username` (`username`),
  UNIQUE KEY `uk_users_email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 2. 第三方账号绑定表 `user_oauth_accounts`

**用途**：记录 QQ / 微信 / 支付宝 等第三方登录信息。

**字段建议**
- `id`
- `user_id`：关联 `users.id`
- `provider`：提供方标识（qq / wechat / alipay）
- `open_id`：第三方唯一用户标识
- `union_id`：可选，微信等会有 unionid
- `access_token` / `refresh_token`（可选）
- `expires_at`（可选）
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `user_oauth_accounts` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `provider` VARCHAR(32) NOT NULL,
  `open_id` VARCHAR(128) NOT NULL,
  `union_id` VARCHAR(128) DEFAULT NULL,
  `access_token` VARCHAR(255) DEFAULT NULL,
  `refresh_token` VARCHAR(255) DEFAULT NULL,
  `expires_at` DATETIME DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_oauth_provider_open` (`provider`, `open_id`),
  KEY `idx_oauth_user` (`user_id`),
  CONSTRAINT `fk_oauth_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 3. 短信验证码记录表 `sms_codes`（可选）

**用途**：记录发送过的短信验证码，用于登录 / 注册 / 找回密码。

**字段建议**
- `id`
- `phone`
- `code`
- `scene`：场景（login / register / reset_password）
- `is_used`：是否已使用
- `expired_at`
- `created_at`

**示例建表 SQL**
```sql
CREATE TABLE `sms_codes` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `phone` VARCHAR(20) NOT NULL,
  `code` VARCHAR(10) NOT NULL,
  `scene` VARCHAR(32) NOT NULL,
  `is_used` TINYINT(1) NOT NULL DEFAULT 0,
  `expired_at` DATETIME NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_sms_phone_scene` (`phone`, `scene`, `is_used`),
  KEY `idx_sms_expired_at` (`expired_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

## 三、课程与课程表相关

### 1. 课程表 `courses`

**用途**：记录课程基本信息（不区分具体时间段）。

**字段建议**
- `id`
- `user_id`：创建者 / 所属学生（如果是个人课表）
- `name`：课程名称
- `teacher`：授课教师
- `color`：课程颜色（如 #RRGGBB）
- `remark`：备注
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `courses` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `name` VARCHAR(128) NOT NULL,
  `teacher` VARCHAR(128) DEFAULT NULL,
  `color` VARCHAR(16) DEFAULT NULL,
  `remark` VARCHAR(255) DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_courses_user` (`user_id`),
  CONSTRAINT `fk_courses_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 2. 课程时间片表 `course_sessions`

**用途**：记录具体“上课时间 + 地点 + 周次”等信息，一个课程可对应多条。

**字段建议**
- `id`
- `course_id`：关联 `courses.id`
- `user_id`：冗余字段，便于按用户筛选
- `weekday`：星期几（1-7）
- `start_time`：上课时间（如 08:00）
- `end_time`：下课时间
- `location`：教室 / 上课地点
- `start_week`：开始周
- `end_week`：结束周
- `week_type`：周类型（all / odd / even）
- `semester`：学期标识（如 2024-2025-1）
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `course_sessions` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `course_id` BIGINT UNSIGNED NOT NULL,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `weekday` TINYINT NOT NULL COMMENT '1=周一 ... 7=周日',
  `start_time` TIME NOT NULL,
  `end_time` TIME NOT NULL,
  `location` VARCHAR(128) DEFAULT NULL,
  `start_week` INT NOT NULL,
  `end_week` INT NOT NULL,
  `week_type` ENUM('all', 'odd', 'even') NOT NULL DEFAULT 'all',
  `semester` VARCHAR(32) NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_sessions_course` (`course_id`),
  KEY `idx_sessions_user_semester` (`user_id`, `semester`, `weekday`),
  CONSTRAINT `fk_sessions_course` FOREIGN KEY (`course_id`) REFERENCES `courses` (`id`),
  CONSTRAINT `fk_sessions_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 3. 课程资料表 `course_materials`

**用途**：存储课程相关文件（课件、资料等）的元数据。

**字段建议**
- `id`
- `course_id`
- `user_id`
- `file_name`
- `file_url`
- `file_type`：pdf / ppt / doc / image / other
- `size`：文件大小（字节）
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `course_materials` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `course_id` BIGINT UNSIGNED NOT NULL,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `file_name` VARCHAR(255) NOT NULL,
  `file_url` VARCHAR(512) NOT NULL,
  `file_type` VARCHAR(32) DEFAULT NULL,
  `size` BIGINT DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_materials_course` (`course_id`),
  KEY `idx_materials_user` (`user_id`),
  CONSTRAINT `fk_materials_course` FOREIGN KEY (`course_id`) REFERENCES `courses` (`id`),
  CONSTRAINT `fk_materials_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 4. 课程笔记表 `course_notes`

**用途**：学生针对某门课或某次课记录的笔记。

**字段建议**
- `id`
- `course_id`
- `user_id`
- `session_id`：可选，关联具体某次上课 `course_sessions.id`
- `title`
- `content`：富文本或 Markdown
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `course_notes` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `course_id` BIGINT UNSIGNED NOT NULL,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `session_id` BIGINT UNSIGNED DEFAULT NULL,
  `title` VARCHAR(255) NOT NULL,
  `content` MEDIUMTEXT NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_notes_course` (`course_id`),
  KEY `idx_notes_user` (`user_id`),
  KEY `idx_notes_session` (`session_id`),
  CONSTRAINT `fk_notes_course` FOREIGN KEY (`course_id`) REFERENCES `courses` (`id`),
  CONSTRAINT `fk_notes_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_notes_session` FOREIGN KEY (`session_id`) REFERENCES `course_sessions` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 5. 课程录音表 `course_recordings`

**用途**：保存与课程相关的录音元数据。

**字段建议**
- `id`
- `course_id`
- `user_id`
- `session_id`：可选
- `file_url`
- `duration_seconds`
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `course_recordings` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `course_id` BIGINT UNSIGNED NOT NULL,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `session_id` BIGINT UNSIGNED DEFAULT NULL,
  `file_url` VARCHAR(512) NOT NULL,
  `duration_seconds` INT DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_recordings_course` (`course_id`),
  KEY `idx_recordings_user` (`user_id`),
  KEY `idx_recordings_session` (`session_id`),
  CONSTRAINT `fk_recordings_course` FOREIGN KEY (`course_id`) REFERENCES `courses` (`id`),
  CONSTRAINT `fk_recordings_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_recordings_session` FOREIGN KEY (`session_id`) REFERENCES `course_sessions` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

## 四、计划与任务相关

### 1. 计划表 `plans`

**用途**：记录一个独立的学习 / 项目 / 生活计划。

**字段建议**
- `id`
- `user_id`
- `title`：计划标题
- `type`：计划类型（study / project / life / other）
- `status`：状态（not_started / in_progress / completed / cancelled）
- `start_date`
- `end_date`
- `outline`：计划大纲（简要描述）
- `remark`：备注
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `plans` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `type` VARCHAR(32) NOT NULL DEFAULT 'study',
  `status` VARCHAR(32) NOT NULL DEFAULT 'not_started',
  `start_date` DATE DEFAULT NULL,
  `end_date` DATE DEFAULT NULL,
  `outline` TEXT DEFAULT NULL,
  `remark` VARCHAR(255) DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_plans_user` (`user_id`),
  KEY `idx_plans_status` (`status`),
  CONSTRAINT `fk_plans_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 2. 计划版本表 `plan_versions`（可选）

**用途**：记录某个计划的不同时期版本。

**字段建议**
- `id`
- `plan_id`
- `version_name` / `version_code`
- `content`：本版本的详细描述（JSON 或文本）
- `created_at`

**示例建表 SQL**
```sql
CREATE TABLE `plan_versions` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `plan_id` BIGINT UNSIGNED NOT NULL,
  `version_name` VARCHAR(64) DEFAULT NULL,
  `version_code` VARCHAR(32) DEFAULT NULL,
  `content` MEDIUMTEXT DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_plan_versions_plan` (`plan_id`),
  CONSTRAINT `fk_plan_versions_plan` FOREIGN KEY (`plan_id`) REFERENCES `plans` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 3. 计划设定表 `plan_settings`

**用途**：存储与计划执行规则相关的设定。

**字段建议**
- `id`
- `plan_id`
- `daily_hours`：每日目标学习时长（小时）
- `remind_time`：提醒时间（如 "19:00"）
- `study_goal`：学习目标（短文本）
- `main_target`：主要目标
- `expected_result`：预期结果
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `plan_settings` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `plan_id` BIGINT UNSIGNED NOT NULL,
  `daily_hours` DECIMAL(4,2) DEFAULT NULL,
  `remind_time` TIME DEFAULT NULL,
  `study_goal` VARCHAR(255) DEFAULT NULL,
  `main_target` VARCHAR(255) DEFAULT NULL,
  `expected_result` TEXT DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_plan_settings_plan` (`plan_id`),
  CONSTRAINT `fk_plan_settings_plan` FOREIGN KEY (`plan_id`) REFERENCES `plans` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 4. 计划任务表 `plan_tasks`

**用途**：计划下的子任务。

**字段建议**
- `id`
- `plan_id`
- `user_id`
- `name`：任务名称
- `description`
- `start_datetime`
- `end_datetime`
- `expected_days`：预计用时（按天）
- `priority`：优先级（low / medium / high）
- `status`：状态（not_started / in_progress / completed / cancelled）
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `plan_tasks` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `plan_id` BIGINT UNSIGNED NOT NULL,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `description` TEXT DEFAULT NULL,
  `start_datetime` DATETIME DEFAULT NULL,
  `end_datetime` DATETIME DEFAULT NULL,
  `expected_days` INT DEFAULT NULL,
  `priority` VARCHAR(16) NOT NULL DEFAULT 'medium',
  `status` VARCHAR(32) NOT NULL DEFAULT 'not_started',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_tasks_plan` (`plan_id`),
  KEY `idx_tasks_user` (`user_id`),
  KEY `idx_tasks_status` (`status`),
  CONSTRAINT `fk_tasks_plan` FOREIGN KEY (`plan_id`) REFERENCES `plans` (`id`),
  CONSTRAINT `fk_tasks_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 5. 计划日记表 `plan_diaries`

**用途**：记录每天的计划执行情况、感受等。

**字段建议**
- `id`
- `plan_id`
- `user_id`
- `date`：日记日期
- `content`：日记正文
- `mood`：心情
- `score`：自我评分（如 0–100）
- `summary`：简短总结 / 自我评价
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `plan_diaries` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `plan_id` BIGINT UNSIGNED NOT NULL,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `date` DATE NOT NULL,
  `content` MEDIUMTEXT DEFAULT NULL,
  `mood` VARCHAR(32) DEFAULT NULL,
  `score` INT DEFAULT NULL,
  `summary` VARCHAR(255) DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_diary_plan_date` (`plan_id`, `date`),
  KEY `idx_diary_user` (`user_id`),
  CONSTRAINT `fk_diary_plan` FOREIGN KEY (`plan_id`) REFERENCES `plans` (`id`),
  CONSTRAINT `fk_diary_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 6. 日记附件表 `diary_attachments`

**用途**：日记关联的文件 / 图片。

**字段建议**
- `id`
- `diary_id`：关联 `plan_diaries.id`
- `file_url`
- `file_name`
- `file_type`
- `created_at`

**示例建表 SQL**
```sql
CREATE TABLE `diary_attachments` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `diary_id` BIGINT UNSIGNED NOT NULL,
  `file_url` VARCHAR(512) NOT NULL,
  `file_name` VARCHAR(255) DEFAULT NULL,
  `file_type` VARCHAR(32) DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_attachments_diary` (`diary_id`),
  CONSTRAINT `fk_attachments_diary` FOREIGN KEY (`diary_id`) REFERENCES `plan_diaries` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

## 五、标签与关联

### 1. 标签表 `tags`

**用途**：统一管理所有可用标签。

**字段建议**
- `id`
- `user_id`：私有标签归属用户（如需全局标签，可允许为空）
- `name`
- `color`
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `tags` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED DEFAULT NULL,
  `name` VARCHAR(64) NOT NULL,
  `color` VARCHAR(16) DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tags_user_name` (`user_id`, `name`),
  KEY `idx_tags_user` (`user_id`),
  CONSTRAINT `fk_tags_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 2. 标签关联表 `tag_relations`

**用途**：标签与不同对象（计划 / 任务 / 日记 / 笔记等）的多对多关系。

**字段建议**
- `id`
- `tag_id`
- `target_type`：对象类型（plan / plan_task / plan_diary / course_note 等）
- `target_id`：对象主键
- `created_at`

**示例建表 SQL**
```sql
CREATE TABLE `tag_relations` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `tag_id` BIGINT UNSIGNED NOT NULL,
  `target_type` VARCHAR(32) NOT NULL,
  `target_id` BIGINT UNSIGNED NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_tag_relations_tag` (`tag_id`),
  KEY `idx_tag_relations_target` (`target_type`, `target_id`),
  CONSTRAINT `fk_tag_relations_tag` FOREIGN KEY (`tag_id`) REFERENCES `tags` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

## 六、AI 设置与统计相关

### 1. AI 设置表 `user_ai_settings`

**用途**：保存用户个性化的 AI 配置。

**字段建议**
- `id`
- `user_id`
- `model`：默认使用的大模型名称
- `temperature`：温度
- `max_tokens`：最大回复长度
- `prompt_preset`：默认提示词模板名称或 ID
- `tools_config`：启用的工具 / 插件配置（JSON）
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `user_ai_settings` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `model` VARCHAR(64) DEFAULT NULL,
  `temperature` DECIMAL(3,2) DEFAULT 0.70,
  `max_tokens` INT DEFAULT NULL,
  `prompt_preset` VARCHAR(128) DEFAULT NULL,
  `tools_config` JSON DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_ai_settings_user` (`user_id`),
  CONSTRAINT `fk_ai_settings_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 2. 学习统计表（可选）`study_stats`

**用途**：缓存或聚合统计数据，避免每次动态计算。

**字段建议**
- `id`
- `user_id`
- `date_range_type`：统计范围类型（day / week / month / term）
- `date_range_start`
- `date_range_end`
- `total_study_minutes`
- `completed_plan_count`
- `attended_course_count`
- `extra_data`：其他统计结果（JSON）
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `study_stats` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `date_range_type` VARCHAR(16) NOT NULL,
  `date_range_start` DATE NOT NULL,
  `date_range_end` DATE NOT NULL,
  `total_study_minutes` INT DEFAULT 0,
  `completed_plan_count` INT DEFAULT 0,
  `attended_course_count` INT DEFAULT 0,
  `extra_data` JSON DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_stats_user_range` (`user_id`, `date_range_type`, `date_range_start`, `date_range_end`),
  CONSTRAINT `fk_stats_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### 3. 提醒 / 通知表 `notifications`

**用途**：记录课程提醒、计划提醒等通知。

**字段建议**
- `id`
- `user_id`
- `type`：通知类型（course_reminder / plan_reminder / system）
- `title`
- `content`
- `related_type`：关联对象类型（course_session / plan / plan_task 等）
- `related_id`
- `scheduled_at`：计划发送时间
- `sent_at`：实际发送时间（可空）
- `status`：状态（pending / sent / failed / cancelled）
- `created_at` / `updated_at`

**示例建表 SQL**
```sql
CREATE TABLE `notifications` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `type` VARCHAR(32) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `content` TEXT NOT NULL,
  `related_type` VARCHAR(32) DEFAULT NULL,
  `related_id` BIGINT UNSIGNED DEFAULT NULL,
  `scheduled_at` DATETIME DEFAULT NULL,
  `sent_at` DATETIME DEFAULT NULL,
  `status` VARCHAR(16) NOT NULL DEFAULT 'pending',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_notifications_user` (`user_id`),
  KEY `idx_notifications_status` (`status`, `scheduled_at`),
  KEY `idx_notifications_related` (`related_type`, `related_id`),
  CONSTRAINT `fk_notifications_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

> 使用建议：  
> - 你可以按模块分批创建表，优先建 `users` / `courses` / `course_sessions` / `plans` / `plan_tasks` 等核心表。  
> - 若当前项目仍使用 SQLite，可把这些 SQL 当作字段与索引参考，在 SQLite 语法下改写后再执行。  
> - 真正执行前，建议先在测试库验证一下建表与索引是否符合实际查询需求。 

